<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="msapplication-TileImage" content="/assets/img/win8-tile-144.png">
<meta name="msapplication-TileColor" content="#000000">
<meta property="og:image" content="https://yomotsu.net/assets/img/og-image.png">

<title>Advanced usage of A360 View and Data API | Yomotsu net</title>
<link rel="canonical" href="https://yomotsu.net/blog/2015/10/12/autodesk-a360-view-api.html">
<link rel="alternate" href="/blog/feed.xml" title="Yomotsu net" type="application/atom+xml">

<link rel="stylesheet" href="/assets/css/main.min.css">

</head>
<body>

<header class="ymt-PageHeader">
	<div class="ymt-PageHeader__Inner">
		<div class="ymt-PageHeader__Logo">
			<a href="/">
				<img src="/assets/img/logo.svg" alt="Yomotsu net" width="116" height="36" />
			</a>
		</div>
	</div>
</header>



<div class="ymt-PageContents">
	<div class="ymt-PageContents__Inner">
		<article>

	<div class="ymt-ContentsTitle">
		<div class="ymt-ContentsTitle__Inner">
			<h1 class="ymt-ContentsTitle__Heading">
				Advanced usage of A360 View and Data API
			</h1>
			<div class="ymt-ContentsTitle__Meta">
				Posted : <time datetime="2015-10-11T15:00:00.000Z" itemprop="datePublished">2015-10-12</time>
			</div>
			<div class="ymt-ContentsTitle__Meta">
				
			</div>
		</div>
	</div>


	<div class="ymt-ContentsBody">

		<div class="ymt-Markdown">
			<p>On Oct 9th 2015, the conference called Autodesk University Japan was held in Tokyo, and Akatuka-san who is working for Mozilla japan and I gave a talk about WoT using A360 View-and-Data-API, which is a Web service by Autodesk.</p>
<p><img src="/blog/assets/2015-10-12-autodesk-a360-view-api/img_01.jpg" alt=""></p>
<h2 id="What-is-View-and-Data-API"><a href="#What-is-View-and-Data-API" class="headerlink" title="What is View and Data API?"></a>What is View and Data API?</h2><p>First of all, I’m gonna explain what View and Data API is. Literally, it consists of 2 features, the temporary file storage and the viewer.</p>
<p>The storage accepts several 3D model file formats, such as CAD format, STL, DXF, OBJ, 3DS, DAE and many others. Then it hosts them.</p>
<p>The viewer can show 3D file which is hosted in the storage. The viewer was built on top of three.js and WebGL, done with 100% web standards technology, and no need any plugins.</p>
<p>Additionally, the storage and viewer are connected through WebSocket which is kinda secure streaming connection. Thanks to the connection, it is possible to show a high-poly 3D model, even under internet connection, and the original model file data can be hidden.</p>
<h2 id="Get-started"><a href="#Get-started" class="headerlink" title="Get started"></a>Get started</h2><p>TL;DR, I’ve made a short video and you can just watch it! Most blog posts about the API by Autodesk people are working with Windows, but this time, I will do on Mac book. I hope this could be helpful for you.</p>
<p>Start from <a href="http://developer-autodesk.github.io/LmvQuickStart/" target="_blank" rel="noopener">View and Data API Beta - Quick Start Guide</a>. Example code is available on github <a href="https://github.com/yomotsu/get-started-with-a360-view-api" target="_blank" rel="noopener">https://github.com/yomotsu/get-started-with-a360-view-api</a></p>
<iframe width="560" height="315" src="//www.youtube.com/embed/UEElt0qm4ik" frameborder="0" allowfullscreen></iframe>

<hr>
<p>At that demo what I made for the conference, I added an animation feature which was supposed to sync with a physical clock device. Unfortunately it was not perfect at that time tho. Anyway applying basic animations is possible under the View API version 1.2.16.</p>
<p><img src="/blog/assets/2015-10-12-autodesk-a360-view-api/img_02.jpg" alt=""></p>
<h2 id="How-to-apply-animations"><a href="#How-to-apply-animations" class="headerlink" title="How to apply animations"></a>How to apply animations</h2><p>Basically, View API is a viewer for high poly 3D models, and not for interactive projects so far I think. However you can handle animations with basic transforms, such as translate, rotate and scale, via three.js way but quite different. To do so, I’m gonna share some tips.</p>
<h2 id="How-to-detect-loaded-event"><a href="#How-to-detect-loaded-event" class="headerlink" title="How to detect loaded event"></a>How to detect loaded event</h2><p>If you would like to apply an animation or even just a transform, your app has to wait for load to complete. To detect the timing, there is an event, called <code>Autodesk.Viewing.GEOMETRY_LOADED_EVENT</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Autodesk.Viewing.Viewer3D( viewerElement, &#123;&#125; );</span><br><span class="line"><span class="comment">// snip...</span></span><br><span class="line">viewer.addEventListener(</span><br><span class="line">  Autodesk.Viewing.GEOMETRY_LOADED_EVENT,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// on model loaded callback...</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="How-to-translate"><a href="#How-to-translate" class="headerlink" title="How to translate"></a>How to translate</h2><p>Use FragProxy feature to get kinda ghost of an actual mesh. Then apply transforms, and update it.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// after loaded entire model...</span></span><br><span class="line"><span class="keyword">var</span> fragId = <span class="number">0</span>; <span class="comment">// &#123;INT&#125; index of fragments of the model, starting at 0</span></span><br><span class="line"><span class="keyword">var</span> fragProxy = viewer.impl.getFragmentProxy( viewer.model, fragId );</span><br><span class="line">fragProxy.getAnimTransform();</span><br><span class="line">fragProxy.position.set( <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span> );</span><br><span class="line">fragProxy.updateAnimTransform();</span><br><span class="line">viewer.impl.sceneUpdated( <span class="literal">true</span> );</span><br></pre></td></tr></table></figure>
<h2 id="How-to-rotate"><a href="#How-to-rotate" class="headerlink" title="How to rotate"></a>How to rotate</h2><p>Similar to translate, but a little bit complicated. Because the viewer does not support local coords, and you have to use world coords instead. Plus fragProxy only accepts quaternion to rotate. When you would like to rotate a mesh in the model, follow the steps below.</p>
<p>The model is assumed to contain some meshes,</p>
<ul>
<li>Before upload the model to the storage, align all parts (meshes) to center of the bounding box which contain all the model, using your 3D modeler software. Because when the model is loaded into the viewer, the center of the bounding box will be the origin of the world coords. The would X, Y, Z axises will be the axis of rotation.</li>
<li>And then, after loaded the entire model, just re-arrange each parts to the original position.</li>
<li>If you would like to apply rotate animation, follow the steps<ol>
<li>Rotate a mesh using quaternion.</li>
<li>Then move position to whatever you want to place.</li>
</ol>
</li>
</ul>
<p>e.g. to rotate 60 deg,</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assume to the all parts (meshes) are aligned to center...</span></span><br><span class="line"><span class="comment">// after loaded all...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> AXIS_Z    = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"><span class="keyword">var</span> position  = <span class="keyword">new</span> THREE.Vector3( <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span> );</span><br><span class="line"><span class="keyword">var</span> deg       = <span class="number">60</span>;</span><br><span class="line"><span class="keyword">var</span> fragId    = <span class="number">0</span>; <span class="comment">// &#123;INT&#125; index of fragments of the model, starting at 0</span></span><br><span class="line"><span class="keyword">var</span> fragProxy = viewer.impl.getFragmentProxy( viewer.model, fragId );</span><br><span class="line"></span><br><span class="line">fragProxy.getAnimTransform();</span><br><span class="line"><span class="comment">// rotate first</span></span><br><span class="line">flagProxy.quaternion.setFromAxisAngle( AXIS_Z, THREE.Math.degToRad( deg ) );</span><br><span class="line"><span class="comment">// re-arrange to the original position</span></span><br><span class="line">fragProxy.position.copy( position );</span><br><span class="line">fragProxy.updateAnimTransform();</span><br><span class="line">viewer.impl.sceneUpdated( <span class="literal">true</span> );</span><br></pre></td></tr></table></figure>
<h2 id="How-to-animate-it"><a href="#How-to-animate-it" class="headerlink" title="How to animate it"></a>How to animate it</h2><p>Just render every frame like three.js way after you applied transform with above tips.</p>
<h2 id="How-to-set-the-viewport-size"><a href="#How-to-set-the-viewport-size" class="headerlink" title="How to set the viewport size"></a>How to set the viewport size</h2><p>After you make a viewer instance, set container size immediately.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> viewer = <span class="keyword">new</span> Autodesk.Viewing.Viewer3D( viewerElement, &#123;&#125; );</span><br><span class="line">viewer.container.style.width  = <span class="string">'600px'</span>;</span><br><span class="line">viewer.container.style.height = <span class="string">'400px'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="How-to-resize-the-viewport-size-whenever-you-want"><a href="#How-to-resize-the-viewport-size-whenever-you-want" class="headerlink" title="How to resize the viewport size whenever you want"></a>How to resize the viewport size whenever you want</h2><p>Set container size and then, execute resize() method.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewer.container.style.width  = <span class="string">'1000px'</span>;</span><br><span class="line">viewer.container.style.height = <span class="string">'1000px'</span>;</span><br><span class="line">viewer.resize();</span><br></pre></td></tr></table></figure>
<h2 id="The-code-of-the-the-demo"><a href="#The-code-of-the-the-demo" class="headerlink" title="The code of the the demo"></a>The code of the the demo</h2><p>At the end, I will attach the code for the demo. This is not connected to the clock device and works as a stand alone with animations.</p>
<iframe width="560" height="315" src="//www.youtube.com/embed/RnRBroI7qIw" frameborder="0" allowfullscreen></iframe>

<h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://developer.api.autodesk.com/viewingservice/v1/viewers/style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://developer.api.autodesk.com/viewingservice/v1/viewers/viewer3D.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- snip... --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"modelData.play()"</span>&gt;</span>play<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"modelData.pause()"</span>&gt;</span>pause<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"viewerContainer"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line">;( <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A360 viewer version: 1.2.16</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> urn = <span class="string">'dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6ZXhhbXBsZTEvY2xvY2szLjNkcw'</span>;</span><br><span class="line">  <span class="keyword">let</span> viewerElement = <span class="built_in">document</span>.getElementById( <span class="string">'viewerContainer'</span> );</span><br><span class="line">  <span class="keyword">let</span> viewer = <span class="keyword">new</span> Autodesk.Viewing.Viewer3D( viewerElement, &#123;&#125; );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ModelData = <span class="function"><span class="keyword">function</span> (<span class="params"> viewer </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.isAnim = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.viewer = viewer;</span><br><span class="line">    <span class="keyword">this</span>.clock  = <span class="keyword">new</span> THREE.Clock();</span><br><span class="line">    <span class="keyword">this</span>.mesh = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// outer gear</span></span><br><span class="line">        id: <span class="number">0</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">16.4</span>, <span class="number">5.5</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// body</span></span><br><span class="line">        id: <span class="number">1</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// inner gear</span></span><br><span class="line">        id: <span class="number">2</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">16.4</span>, <span class="number">5.5</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// small gear top</span></span><br><span class="line">        id: <span class="number">3</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">53.5</span>, <span class="number">5.25</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> * <span class="number">5</span> + <span class="number">20</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// small gear left</span></span><br><span class="line">        id: <span class="number">4</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">5.2</span>, <span class="number">29</span>, <span class="number">5.25</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> * <span class="number">5</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// small gear right</span></span><br><span class="line">        id: <span class="number">5</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">-5.2</span>, <span class="number">29</span>, <span class="number">5.25</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> * <span class="number">5</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// shaft top</span></span><br><span class="line">        id: <span class="number">6</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">53.5</span>, <span class="number">5.25</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> * <span class="number">5</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// shaft left</span></span><br><span class="line">        id: <span class="number">7</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">5.2</span>, <span class="number">29</span>, <span class="number">5.25</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> * <span class="number">5</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// shaft left</span></span><br><span class="line">        id: <span class="number">8</span>,</span><br><span class="line">        flagProxy: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="keyword">new</span> THREE.Vector3( <span class="number">-5.2</span>, <span class="number">29</span>, <span class="number">5.25</span> ),</span><br><span class="line">        animation: ( <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> AXIS = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"> time </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            that.rotate( <span class="keyword">this</span>.flagProxy, AXIS, time * <span class="number">60</span> * <span class="number">5</span> );</span><br><span class="line">            that.translate( <span class="keyword">this</span>.flagProxy, <span class="keyword">this</span>.position );</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; )()</span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mesh</span></span><br><span class="line">    <span class="keyword">this</span>.mesh.forEach( <span class="function"><span class="keyword">function</span> (<span class="params"> obj </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> flagProxy;</span><br><span class="line"></span><br><span class="line">      flagProxy = viewer.impl.getFragmentProxy( viewer.model, obj.id );</span><br><span class="line">      obj.flagProxy = flagProxy;</span><br><span class="line">      obj.animation( <span class="number">0</span> );</span><br><span class="line"></span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ModelData.prototype = &#123;</span><br><span class="line"></span><br><span class="line">    translate: <span class="function"><span class="keyword">function</span> (<span class="params"> flagProxy, vec3 </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      flagProxy.getAnimTransform();</span><br><span class="line">      flagProxy.position.copy( vec3 );</span><br><span class="line">      flagProxy.updateAnimTransform();</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    scale: <span class="function"><span class="keyword">function</span> (<span class="params"> flagProxy, vec3 </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      flagProxy.getAnimTransform();</span><br><span class="line">      flagProxy.scale.copy( vec3 );</span><br><span class="line">      flagProxy.updateAnimTransform();</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    rotate: <span class="function"><span class="keyword">function</span> (<span class="params"> flagProxy, axis, deg </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      flagProxy.getAnimTransform();</span><br><span class="line">      flagProxy.quaternion.setFromAxisAngle( axis, THREE.Math.degToRad( deg ) );</span><br><span class="line">      flagProxy.updateAnimTransform();</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    play: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.clock.start();</span><br><span class="line">      <span class="keyword">this</span>.isAnim = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.animation();</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    pause: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.clock.stop();</span><br><span class="line">      <span class="keyword">this</span>.isAnim = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    animation: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( !<span class="keyword">this</span>.isAnim ) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line"></span><br><span class="line">      requestAnimationFrame( <span class="keyword">this</span>.animation.bind( <span class="keyword">this</span> ) );</span><br><span class="line">      <span class="keyword">let</span> theta = <span class="keyword">this</span>.clock.getElapsedTime();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.mesh.forEach( <span class="function"><span class="keyword">function</span> (<span class="params"> obj </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        obj.animation( theta );</span><br><span class="line"></span><br><span class="line">      &#125; );</span><br><span class="line"></span><br><span class="line">      viewer.impl.invalidate( <span class="literal">true</span> );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//--</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> accessToken = &#123;</span><br><span class="line">    <span class="comment">// expires: 0,</span></span><br><span class="line">    data: <span class="literal">null</span>,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.data;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function"><span class="keyword">function</span>(<span class="params"> onFulfilled, onRejected </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> req = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        req.open( <span class="string">'GET'</span>, <span class="string">'./get-token.php'</span> );</span><br><span class="line"></span><br><span class="line">        req.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> ( req.status === <span class="number">200</span> ) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse( req.response );</span><br><span class="line">            <span class="comment">// accessToken.expires = Date.now() + data.expires_in;</span></span><br><span class="line">            accessToken.data    = data.access_token;</span><br><span class="line">            onFulfilled();</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        req.send();</span><br><span class="line"></span><br><span class="line">      &#125; );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//--</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">initViewer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> options = &#123;</span><br><span class="line"></span><br><span class="line">      env:<span class="string">'AutodeskProduction'</span>,</span><br><span class="line">      accessToken: accessToken.get(),</span><br><span class="line">      <span class="built_in">document</span> : <span class="string">'urn:'</span> + urn,</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function"><span class="keyword">function</span>(<span class="params"> onFulfilled, onRejected </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      Autodesk.Viewing.Initializer( options, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        viewer.initialize();</span><br><span class="line">        viewer.impl.setLightPreset( <span class="number">8</span> );</span><br><span class="line">        viewer.setOptimizeNavigation( <span class="literal">true</span> );</span><br><span class="line">        <span class="comment">// viewer.navigation.setZoomTowardsPivot( true );</span></span><br><span class="line">        <span class="comment">// viewer.navigation.setReverseZoomDirection( true );</span></span><br><span class="line">        onFulfilled();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        viewer.addEventListener(</span><br><span class="line">          Autodesk.Viewing.SELECTION_CHANGED_EVENT,</span><br><span class="line">          <span class="function"><span class="keyword">function</span> (<span class="params"> event </span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log( event.fragIdsArray );</span><br><span class="line">        &#125; );</span><br><span class="line"></span><br><span class="line">      &#125; );</span><br><span class="line"></span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadDocument</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function"><span class="keyword">function</span>(<span class="params"> onFulfilled, onRejected </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      viewer.addEventListener(</span><br><span class="line">        Autodesk.Viewing.GEOMETRY_LOADED_EVENT,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; onFulfilled(); &#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      Autodesk.Viewing.Document.load( <span class="string">'urn:'</span> + urn, <span class="function"><span class="keyword">function</span> (<span class="params"> doc </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> geometryItems = [];</span><br><span class="line"></span><br><span class="line">        geometryItems = Autodesk.Viewing.Document.getSubItemsWithProperties(</span><br><span class="line">          doc.getRootItem(),</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">'type'</span> : <span class="string">'geometry'</span>,</span><br><span class="line">            <span class="string">'role'</span> : <span class="string">'3d'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="literal">true</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( geometryItems.length &gt; <span class="number">0</span> ) &#123;</span><br><span class="line"></span><br><span class="line">          viewer.load( doc.getViewablePath( geometryItems[ <span class="number">0</span> ] ) );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"> errorMsg </span>) </span>&#123;<span class="comment">// onErrorCallback</span></span><br><span class="line"></span><br><span class="line">        alert( <span class="string">'Load Error: '</span> + errorMsg );</span><br><span class="line"></span><br><span class="line">      &#125; );</span><br><span class="line"></span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onload</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'loaded!'</span> );</span><br><span class="line">    <span class="built_in">window</span>.modelData = <span class="keyword">new</span> ModelData( viewer );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//--</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then( accessToken.update )</span><br><span class="line">  .then( initViewer )</span><br><span class="line">  .then( loadDocument )</span><br><span class="line">  .then( onload );</span><br><span class="line"></span><br><span class="line">&#125; )();</span><br></pre></td></tr></table></figure>
<h3 id="get-token-php-replace-XXX…-and-YYY…-to-your-setting"><a href="#get-token-php-replace-XXX…-and-YYY…-to-your-setting" class="headerlink" title="get-token.php (replace XXX… and YYY… to your setting)"></a>get-token.php (replace XXX… and YYY… to your setting)</h3><p>Actually, the code is very similar to the curl command what you saw at the first step, then this will return a token in JSON.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">	$MY_CONSUMER_KEY    = <span class="string">'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'</span>;</span><br><span class="line">	$MY_CONSUMER_SECRET = <span class="string">'YYYYYYYYYYYYYYYY'</span>;</span><br><span class="line">	$url    = <span class="string">'https://developer.api.autodesk.com/authentication/v1/authenticate'</span>;</span><br><span class="line">	$data   = <span class="string">'client_id='</span>.$MY_CONSUMER_KEY.<span class="string">'&amp;client_secret='</span>.$MY_CONSUMER_SECRET.<span class="string">'&amp;grant_type=client_credentials'</span>;</span><br><span class="line">	$header = <span class="keyword">array</span>( <span class="string">'Content-Type: application/x-www-form-urlencoded'</span> );</span><br><span class="line"></span><br><span class="line">	$ch = curl_init();</span><br><span class="line">	curl_setopt( $ch, CURLOPT_URL, $url );</span><br><span class="line">	curl_setopt( $ch, CURLOPT_POSTFIELDS, $data );   <span class="comment">// --data</span></span><br><span class="line">	curl_setopt( $ch, CURLOPT_HTTPHEADER, $header ); <span class="comment">// --header</span></span><br><span class="line">	curl_exec( $ch );</span><br><span class="line">	curl_close( $ch );</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

		</div>

		
			<div class="ymt-ArticleNav">
	<ul class="ymt-ArticleNav__List">
		<li class="ymt-ArticleNav__Item ymt-ArticleNav__Item--home">
			<a href="/blog/">Blog Top</a>
		</li>
		<li class="ymt-ArticleNav__Item ymt-ArticleNav__Item--prev">
			
				<a href="/blog/2015/07/29/simdjs.html">
					SIMD.js を使ってみる
				</a> 
			
		</li>
		<li class="ymt-ArticleNav__Item ymt-ArticleNav__Item--next">
			
				<a href="/blog/2015/10/31/three-r73-anim.html">
					New skinned mesh animation system in three.js r73 and r74
				</a>
			
		</li>
	</ul>
</div>

		

		
			<div id="disqus_thread"></div>
		

	</div>

</article>


	</div>
</div>


<footer class="ymt-PageFooter">
	<div class="ymt-PageFooter__Inner">

		<aside class="ymt-PageFooter__Author">
			<h1>Author</h1>
			<div class="ymt-PageFooter__AuthorImage">
				<img src="//www.gravatar.com/avatar/3d8d92b9ff9e708e3e4c247d5ab787ba.png?s=256" alt="" width="80" height="80">
				<img src="/assets/img/mvp.png" alt="Microsoft MVP" width="40" height="64">
			</div>
			<div class="ymt-PageFooter__AuthorText">
				<p>Akihiro Oyamada (a.k.a yomotsu) </p>
				<p>I'm a Web-Front-End-Engineer, as well as a Microsoft MVP for Internet Explorer since 2011 to 2017. Playing with CSS3, SVG, WebGL and others.</p>
				<!-- <p>執筆や講演の履歴など、<a href="/profile/">さらに詳細な情報は Profile をお読みください</a>。</p> -->
				<hr>
				<p>If you have any feedback or comments, as well as speaker invitation, use <a href="/contact/">Contact form</a>.<br>For business or project offering, email my company info@pxgrid.com</p>
				<p>ご意見ご感想や、執筆、講演などのご相談は<a href="/contact/">お問い合わせフォーム</a>へ。<br>Web 制作のご相談は info@pxgrid.com へ。</p>
			</div>
		</aside>

		<aside class="ymt-PageFooter__Aside ymt-PageFooter__Aside--social">
			<h1>Find Me!</h1>
			<ul>
				<li><a href="https://www.facebook.com/akihiro.oyamada">Facebook</a></li>
				<li><a href="https://twitter.com/yomotsu/">Twitter</a></li>
				<li><a href="https://github.com/yomotsu/">GitHub</a></li>
			</ul>
		</aside>

		<aside class="ymt-PageFooter__Aside ymt-PageFooter__Aside--aside">
			<h1>Subscribe to this Blog!</h1>
			<ul>
				<li><a href="/blog/feed.xml">Feed</a></li>
			</ul>
		</aside>

	</div>
</footer>


<div class="ymt-PageBackground"></div>

<script src="/assets/js/main.min.js"></script>
</body>
</html>
